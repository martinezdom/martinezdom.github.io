---
const { language } = Astro.props;

const LANGUAGES = [
  { code: "ES", value: "es", path: "/" },
  { code: "EN", value: "en", path: "/en" },
  { code: "VA", value: "va", path: "/va" },
];

const currentLang = LANGUAGES.find(lang => lang.value === language.prefix) || LANGUAGES[0];
---

<div class="relative inline-block">
  <button
    id="lang-selector"
    class="py-1 text-sm font-medium text-slate-900 hover:text-indigo-500 dark:text-white dark:hover:text-indigo-400 transition-colors duration-200 flex items-center gap-1"
    aria-expanded="false"
  >
    <span id="current-lang">{currentLang.code}</span>
    <svg class="w-3 h-3 transition-transform duration-200" id="lang-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <div
    id="lang-menu"
    class="hidden absolute top-full right-0 mt-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-md shadow-lg py-1 min-w-[60px]"
    role="menu"
  >
    {LANGUAGES.map((lang) => (
      <a
        href={lang.path}
        class="block px-4 py-2 text-sm text-slate-900 dark:text-slate-200 hover:bg-indigo-50 dark:hover:bg-slate-800 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-150"
        data-lang={lang.value}
      >
        {lang.code}
      </a>
    ))}
  </div>
</div>

<script is:inline>
  const langSelector = document.getElementById('lang-selector');
  const langMenu = document.getElementById('lang-menu');
  const langArrow = document.getElementById('lang-arrow');

  const toggleLanguageMenu = () => {
    const isOpen = langSelector.getAttribute('aria-expanded') === 'true';
    langMenu.classList.toggle('hidden', isOpen);
    langSelector.setAttribute('aria-expanded', !isOpen);
    langArrow.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
  };

  const closeLanguageMenu = () => {
    langMenu.classList.add('hidden');
    langSelector.setAttribute('aria-expanded', 'false');
    langArrow.style.transform = 'rotate(0deg)';
  };

  langSelector.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleLanguageMenu();
  });

  document.addEventListener('click', (e) => {
    if (!langSelector.contains(e.target) && !langMenu.contains(e.target)) {
      closeLanguageMenu();
    }
  });
</script>
